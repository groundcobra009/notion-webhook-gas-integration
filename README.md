# 📊 Notion → Google Sheets 自動連携システム

NotionのオートメーションからWebhookを受信して、自動的にGoogleスプレッドシートに記録するGoogle Apps Script（GAS）プロジェクトです。

## 🎯 このプロジェクトでできること

- Notionのデータベースからタスク情報を自動取得
- Googleスプレッドシートに自動記録
- リアルタイムでタスクの完了状況を追跡
- 複数のタスクプロパティ（優先度、担当者、期日など）に対応

## 📁 プロジェクト構成

```
📦 NotiontoSPオートメーション/
├── 📄 README.md              # このファイル
├── 📄 appsscript.json         # GASプロジェクト設定
├── 📂 src/                    # ソースコード
│   └── 📄 コード.js          # メインスクリプト
└── 📂 docs/                   # ドキュメント
    └── 📄 CLAUDE.md           # 開発者向けガイド
```

## 🚀 セットアップ手順（初心者向け）

### ステップ1: Googleスプレッドシートの準備

1. [Google Sheets](https://sheets.google.com) を開く
2. 新しいスプレッドシートを作成
3. 任意の名前を付ける（例：「Notionタスク管理」）

### ステップ2: Google Apps Scriptの設定

1. スプレッドシートで「拡張機能」→「Apps Script」をクリック
2. 既存のコード（`function myFunction() {}`）を削除
3. `src/コード.js` の内容をすべてコピー＆ペースト
4. `appsscript.json` の内容も同様にコピー＆ペースト
5. 「保存」をクリック（Ctrl+S または ⌘+S）

### ステップ3: 初期設定

1. スプレッドシートに戻る
2. ページを再読み込み（F5）
3. 新しく追加された「🔧 Notion連携設定」メニューをクリック
4. 「📝 初期設定」を選択
5. 設定画面で以下を入力：
   - **スプレッドシートID**: 自動入力されます
   - **シート名**: 「Notion_タスク記録」（推奨）
6. 「💾 設定を保存」をクリック

### ステップ4: Webアプリとしてデプロイ

1. Apps Scriptエディタで「デプロイ」→「新しいデプロイ」
2. 種類で「ウェブアプリ」を選択
3. 設定：
   - **実行ユーザー**: 自分
   - **アクセスできるユーザー**: 全員
4. 「デプロイ」をクリック
5. **ウェブアプリのURL**をコピー（重要！）

### ステップ5: Notionとの連携設定

1. Notionでタスク管理用のデータベースを開く
2. 右上の「⋯」メニューから「オートメーション」を選択
3. 「新しいオートメーション」を作成
4. トリガー：「タスクが完了したとき」など
5. アクション：「Webhookを送信する」を選択
6. URL欄に、ステップ4でコピーしたURLを貼り付け
7. 送信するプロパティを選択（後述の対応プロパティ参照）
8. 保存

## 📋 対応するNotionプロパティ

スクリプトは以下のNotionプロパティに対応しています：

| プロパティ名 | タイプ | 説明 |
|-------------|--------|------|
| タスク名 | タイトル | タスクのメインタイトル |
| 担当者 | ユーザー | タスクの担当者 |
| 優先度 | セレクト | 高・中・低 |
| ステータス | ステータス | 未着手・進行中・完了など |
| 期日 | 日付 | タスクの期限 |
| 期限超過 | 数式 | 期限を過ぎているかの判定 |
| 工数レベル | セレクト | 作業量の目安 |
| 説明 | テキスト | タスクの詳細説明 |

## 🧪 動作テスト

設定完了後、以下の手順でテストできます：

1. スプレッドシートの「🔧 Notion連携設定」メニュー
2. 「🧪 テスト実行」を選択
3. テストデータが正常に記録されることを確認

## ❓ トラブルシューティング

### よくある問題と解決方法

**Q: メニューが表示されない**
- スプレッドシートを再読み込みしてください
- Apps Scriptの保存を確認してください

**Q: データが記録されない**
- 「✅ 設定確認」でスプレッドシート接続を確認
- NotionのWebhook URLが正しいか確認
- Apps Scriptの実行ログを確認（拡張機能 → Apps Script → 実行数）

**Q: 一部のプロパティが記録されない**
- Notionのプロパティ名が日本語で正確に設定されているか確認
- プロパティのタイプが対応しているか確認

## 📞 サポート

- **設定確認**: メニューの「✅ 設定確認」
- **ログ確認**: メニューの「📊 受信ログを確認」
- **Webhook URL**: メニューの「🔗 Webhook URLを表示」

## 📝 更新履歴

- **2025/07/27**: プロジェクト初期作成
  - Notion Webhook受信機能
  - Google Sheets自動記録機能
  - 初心者向けセットアップガイド

---

💡 **ヒント**: 初回設定で不明な点があれば、各メニューの「設定確認」や「テスト実行」を活用してください！