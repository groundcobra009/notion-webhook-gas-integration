# Notion to Google Sheets 連携システム 要件定義書

## 1. システム概要

### 1.1 目的
NotionデータベースのタスクやレコードをGoogle Sheetsに自動的に同期・記録するシステムの構築

### 1.2 主要機能
- NotionのオートメーションからWebhookを受信
- 受信したデータをGoogle Sheetsに自動記録
- 設定画面による簡単なセットアップ
- テスト機能による動作確認

## 2. 機能要件

### 2.1 Webhook受信機能
- **エンドポイント**: Google Apps Script Web Appとして公開
- **HTTPメソッド**: POST
- **認証**: ANYONE_ANONYMOUS（誰でもアクセス可能）
- **データ形式**: JSON
- **レスポンス**: JSON形式で成功/エラーステータスを返却

### 2.2 データ記録機能
- **記録先**: 指定されたGoogle Spreadsheet
- **記録形式**: 行単位での追加
- **記録項目**:
  - 記録日時（自動生成）
  - タスク名
  - 担当者
  - 優先度
  - ステータス
  - 期日
  - 期限超過
  - 工数レベル
  - 説明

### 2.3 設定管理機能
- **設定項目**:
  - スプレッドシートID
  - シート名（デフォルト: Notion_タスク記録）
- **保存方法**: Script Properties
- **UI**: モーダルダイアログによる設定画面

### 2.4 ユーザーインターフェース
- **メニュー項目**:
  - 初期設定
  - 設定確認
  - テスト実行
  - Webhook URL表示
  - 受信ログ確認
- **設定画面**: HTMLベースのモーダルダイアログ
- **通知**: アラートダイアログによる成功/エラー通知

### 2.5 データ変換機能
- **Notionプロパティタイプ対応**:
  - title（タイトル）
  - rich_text（リッチテキスト）
  - select（選択）
  - multi_select（複数選択）
  - status（ステータス）
  - people（ユーザー）
  - date（日付）
  - number（数値）
  - checkbox（チェックボックス）
  - formula（数式）
  - url、email、phone_number

## 3. 非機能要件

### 3.1 パフォーマンス
- Webhook受信から記録完了まで: 2秒以内
- 同時アクセス: Google Apps Scriptの制限に準拠

### 3.2 可用性
- Google Apps Scriptのサービス稼働率に依存
- エラー時の自動リトライなし（Notion側で再送信可能）

### 3.3 セキュリティ
- HTTPS通信による暗号化
- スクリプトプロパティによる設定情報の保護
- ヘッダー行の保護（警告表示のみ）

### 3.4 拡張性
- 新しいNotionプロパティタイプへの対応が容易
- カラムの追加・変更が可能

## 4. 制約事項

### 4.1 技術的制約
- Google Apps Scriptの実行時間制限（6分）
- URLフェッチの制限
- 同時実行数の制限

### 4.2 機能的制約
- 一方向同期のみ（Notion → Google Sheets）
- リアルタイム同期ではない（Notionのオートメーション実行時のみ）
- データの更新・削除は非対応（追加のみ）

## 5. 利用想定シナリオ

### 5.1 初期セットアップ
1. スクリプトをGoogle Apps Scriptにデプロイ
2. メニューから「初期設定」を実行
3. スプレッドシートIDとシート名を設定
4. Webhook URLを取得

### 5.2 Notion側の設定
1. Notionデータベースでオートメーションを作成
2. トリガー条件を設定（例：ステータスが「完了」に変更）
3. アクションで「Webhookを送信」を選択
4. 取得したWebhook URLを設定
5. 送信するプロパティを選択

### 5.3 運用時
1. Notionでタスクのステータスを変更
2. オートメーションが自動実行
3. WebhookがGoogle Apps Scriptに送信
4. データがGoogle Sheetsに自動記録

## 6. 今後の拡張可能性

- 双方向同期機能
- 複数のNotionデータベース対応
- カスタムフィールドマッピング
- データ集計・レポート機能
- Slack等への通知連携